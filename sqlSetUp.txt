
CREATE SCHEMA Task_Management;

USE Task_Management;

CREATE TABLE departments (
department_id INT AUTO_INCREMENT PRIMARY KEY,
manager_id INT,
name NVARCHAR(40)
);

CREATE TABLE employees 
(
employee_id INT AUTO_INCREMENT PRIMARY KEY,
first_name NVARCHAR(20) NOT NULL,
last_name NVARCHAR(20) NOT NULL,
egn CHAR(10) NOT NULL,
email NVARCHAR(50) NOT NULL,
department_id INT, FOREIGN KEY(department_id) REFERENCES departments(department_id),
telephone CHAR(10)
);

ALTER TABLE Departments
ADD FOREIGN KEY (manager_Id) REFERENCES employees (employee_id);

CREATE TABLE status 
(
status_id INT AUTO_INCREMENT PRIMARY KEY,
name NVARCHAR(20)
);

CREATE TABLE tasks 
(
task_id INT AUTO_INCREMENT PRIMARY KEY,
name NVARCHAR(30) NOT NULL,
description NVARCHAR(600),
status INT NOT NULL, 
department_id INT NOT NULL,
requester_id INT NOT NULL,
taker_id INT,
FOREIGN KEY(status) REFERENCES status(status_id),
FOREIGN KEY(department_id) REFERENCES departments(department_id),
FOREIGN KEY(requester_id) REFERENCES employees(employee_id),
FOREIGN KEY(taker_id) REFERENCES employees(employee_id),
request_date DATETIME NOT NULL,
deadline_date DATETIME,
date_taken DATETIME,
time_estimate_hours INT,
date_completed DATETIME,
);

SET SCHEMA TASK_MANAGEMENT;

INSERT INTO DEPARTMENTS (MANAGER_ID, NAME) VALUES ( NULL, 'Art');
INSERT INTO DEPARTMENTS (MANAGER_ID, NAME) VALUES ( NULL, 'Programming');
INSERT INTO DEPARTMENTS (MANAGER_ID, NAME) VALUES ( NULL, 'Marketing');

INSERT INTO EMPLOYEES (FIRST_NAME, LAST_NAME, DEPARTMENT_ID, EGN, EMAIL, TELEPHONE)
VALUES ('Laurence', 'Spector', 1, '9999999999', 'PrimeSpector@gmail.com', '0884562315' );

INSERT INTO EMPLOYEES (FIRST_NAME, LAST_NAME, DEPARTMENT_ID, EGN, EMAIL, TELEPHONE)
VALUES ('James', 'Smith', 1, '9999999999', 'SmithSmith@gmail.com', '0881262315' );

INSERT INTO EMPLOYEES (FIRST_NAME, LAST_NAME, DEPARTMENT_ID, EGN, EMAIL, TELEPHONE)
VALUES ( 'John', 'Smith', 1, '9999999999', 'JSmithers@gmail.com', '0884536615' );

INSERT INTO EMPLOYEES (FIRST_NAME, LAST_NAME, DEPARTMENT_ID, EGN, EMAIL, TELEPHONE)
VALUES ( 'David', 'Smith', 1, '9999999999', 'SmithinItUp@gmail.com', '0884565115' );


INSERT INTO STATUS (NAME) VALUES ('Open');
INSERT INTO STATUS (NAME) VALUES ('Taken');
INSERT INTO STATUS (NAME) VALUES ('Completed');
INSERT INTO STATUS (NAME) VALUES ('On Hold');


INSERT INTO TASKS (NAME, DESCRIPTION, STATUS, DEPARTMENT_ID, REQUESTER_ID, REQUEST_DATE)
VALUES ('Create Pathfinding', '', 1, 1, 1, CURRENT_TIMESTAMP );

INSERT INTO TASKS (NAME, DESCRIPTION, STATUS, DEPARTMENT_ID, REQUESTER_ID, REQUEST_DATE)
VALUES ('Upload Trailer', '', 1, 3, 2, CURRENT_TIMESTAMP );

INSERT INTO TASKS (NAME, DESCRIPTION, STATUS, DEPARTMENT_ID, REQUESTER_ID, REQUEST_DATE, DEADLINE_DATE)
VALUES ('Create Main Character Model', '', 1, 3, 2, CURRENT_TIMESTAMP, '2018-3-15' );